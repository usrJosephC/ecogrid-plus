<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EcoGrid+ | Dashboard</title>
    <link rel="stylesheet" href="css/style.css">
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>

<body>
    <div class="container">
        <!-- Header -->
        <header>
            <h1>üåê EcoGrid+</h1>
            <p>Plataforma Inteligente para Redes de Energia Sustent√°veis</p>
            <div class="status-indicator" id="status-indicator">
                <span class="status-dot"></span>
                <span id="status-text">Inicializando...</span>
            </div>
        </header>

        <!-- Control Panel -->
        <section class="control-panel">
            <button onclick="initializeSystem()" class="btn btn-primary">
                üöÄ Inicializar Sistema
            </button>
            <button onclick="resetSystem()" class="btn btn-danger">
                üîÑ Resetar Sistema
            </button>
            <button onclick="refreshData()" class="btn btn-secondary">
                üîÑ Atualizar Dados
            </button>
            <button onclick="simulateOverload()" class="btn btn-warning">
                ‚ö†Ô∏è Simular Sobrecarga
            </button>
            <button onclick="balanceNetwork()" class="btn btn-success">
                ‚öñÔ∏è Balancear Rede
            </button>
            <button onclick="optimizeNetwork()" class="btn btn-warning">
                üîß Otimizar Efici√™ncia
            </button>
            <button onclick="trainML()" class="btn btn-info">
                ü§ñ Treinar ML
            </button>
        </section>

        <!-- Stats Cards -->
        <section class="stats-grid">
            <div class="stat-card">
                <h3>Total de N√≥s</h3>
                <div class="stat-value" id="total-nodes">-</div>
                <span class="stat-label">na rede</span>
            </div>
            <div class="stat-card">
                <h3>Carga Total</h3>
                <div class="stat-value" id="total-load">-</div>
                <span class="stat-label">kW</span>
            </div>
            <div class="stat-card">
                <h3>Utiliza√ß√£o</h3>
                <div class="stat-value" id="utilization">-</div>
                <span class="stat-label">%</span>
            </div>
            <div class="stat-card alert">
                <h3>N√≥s Sobrecarregados</h3>
                <div class="stat-value" id="overloaded-nodes">-</div>
                <span class="stat-label">alertas</span>
            </div>
        </section>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Network Visualization -->
            <div style="margin-bottom: 8px;">
                <button onclick="setNetworkMode('force')" class="btn">Layout por For√ßa</button>
                <button onclick="setNetworkMode('hierarchical')" class="btn">Layout Hier√°rquico</button>
            </div>
            <section class="card card-large">
                <h2>üó∫Ô∏è Visualiza√ß√£o da Rede</h2>
                <div id="network-viz"></div>
            </section>

            <!-- Charts -->
            <section class="card">
                <h2>üìä Distribui√ß√£o de Carga</h2>
                <div class="chart-wrapper">
                    <canvas id="load-chart"></canvas>
                </div>
            </section>

            <section class="card">
                <h2>üìà Previs√£o de Demanda (24h)</h2>
                <div class="chart-wrapper">
                    <canvas id="prediction-chart"></canvas>
                </div>
            </section>
        </div>

        <!-- Tabs -->
        <section class="tabs">
            <div class="tab-buttons">
                <button class="tab-btn active" onclick="showTab('nodes')">N√≥s</button>
                <button class="tab-btn" onclick="showTab('events')">Eventos</button>
                <button class="tab-btn" onclick="showTab('routing')">Roteamento</button>
                <button class="tab-btn" onclick="showTab('efficiency')">Efici√™ncia</button>
                <button class="tab-btn" onclick="showTab('ml')">ML</button>
            </div>

            <!-- Tab: Nodes -->
            <div id="tab-nodes" class="tab-content active">
                <h3>Lista de N√≥s</h3>
                <div class="table-container">
                    <table id="nodes-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Tipo</th>
                                <th>Capacidade (kW)</th>
                                <th>Carga Atual (kW)</th>
                                <th>Utiliza√ß√£o (%)</th>
                                <th>Efici√™ncia</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="nodes-tbody">
                            <tr>
                                <td colspan="7">Carregando...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Tab: Events -->
            <div id="tab-events" class="tab-content">
                <h3>Eventos Cr√≠ticos</h3>
                <div id="events-list" class="events-container">
                    <p>Carregando eventos...</p>
                </div>
            </div>

            <!-- Tab: Routing -->
            <div id="tab-routing" class="tab-content">
                <h3>Buscar Rota √ìtima</h3>
                <div class="form-group">
                    <label>Origem:</label>
                    <input type="text" id="route-source" placeholder="ex: SUB_0">

                    <label>Destino:</label>
                    <input type="text" id="route-destination" placeholder="ex: CONS_5">

                    <label>Algoritmo:</label>
                    <select id="route-algorithm">
                        <option value="dijkstra">Dijkstra</option>
                        <option value="astar">A*</option>
                    </select>

                    <button onclick="findRoute()" class="btn btn-primary">Buscar Rota</button>
                </div>
                <div id="route-result" class="result-container"></div>
            </div>

            <!-- Tab: Efficiency -->
            <div id="tab-efficiency" class="tab-content">
                <h3>An√°lise de Efici√™ncia</h3>
                <div id="efficiency-metrics" class="metrics-container">
                    <div class="metric">
                        <span class="metric-label">Efici√™ncia Global:</span>
                        <span class="metric-value" id="global-efficiency">-</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Perdas Totais:</span>
                        <span class="metric-value" id="total-losses">-</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Pegada de Carbono:</span>
                        <span class="metric-value" id="carbon-footprint">-</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Classifica√ß√£o:</span>
                        <span class="metric-value" id="efficiency-class">-</span>
                    </div>
                </div>
                <h4>Sugest√µes de Energia Renov√°vel</h4>
                <div id="renewable-suggestions"></div>
            </div>

            <div class="metrics-row">
                <div class="metric-card">
                    <span class="metric-label">Sobrecargas detectadas</span>
                    <span id="overload-detected" class="metric-value">0</span>
                </div>
                <div class="metric-card">
                    <span class="metric-label">Sobrecargas resolvidas</span>
                    <span id="overload-resolved" class="metric-value">0</span>
                </div>
                <div class="metric-card">
                    <span class="metric-label">Tempo m√©dio de resposta</span>
                    <span id="overload-avg-time" class="metric-value">0 ms</span>
                </div>
            </div>



            <!-- Tab: ML -->
            <div id="tab-ml" class="tab-content">
                <h3>Intelig√™ncia Artificial (ML)</h3>
                <div class="metrics-row">
                    <div class="metric-card">
                        <span class="metric-label">Amostras de treino</span>
                        <span id="ml-samples" class="metric-value">-</span>
                    </div>
                    <div class="metric-card">
                        <span class="metric-label">Acur√°cia de valida√ß√£o</span>
                        <span id="ml-accuracy" class="metric-value">-</span>
                    </div>
                    <div class="metric-card">
                        <span class="metric-label">Loss de valida√ß√£o</span>
                        <span id="ml-loss" class="metric-value">-</span>
                    </div>
                    <div class="metric-card">
                        <span class="metric-label">√öltimo treinamento</span>
                        <span id="ml-last-train" class="metric-value">-</span>
                    </div>
                </div>

                <p style="margin-top:16px;color:#4b5563;font-size:14px;">
                    <strong>O que essas m√©tricas significam?</strong><br>
                    ‚Ä¢ <strong>Amostras de treino</strong>: quantidade de leituras hist√≥ricas de consumo usadas para ensinar o modelo.<br>
                    ‚Ä¢ <strong>Acur√°cia de valida√ß√£o</strong>: porcentagem de previs√µes corretas em um conjunto de dados que o modelo nunca viu durante o treino.<br>
                    ‚Ä¢ <strong>Loss de valida√ß√£o</strong>: erro m√©dio das previs√µes em rela√ß√£o √† demanda real, em kW. Por exemplo, loss = 7,3 kW significa que, em m√©dia, o modelo erra cerca de 7,3 kW por ponto de previs√£o.
                </p>
                <p style="margin-top:8px;color:#4b5563;font-size:14px;">
                    As leituras s√£o geradas pelos sensores IoT simulados em cada n√≥ da rede. Uma parte desses dados √© usada para
                    <strong>treinar</strong> o modelo e outra parte √© reservada para <strong>valida√ß√£o</strong>. Assim, as m√©tricas exibidas refletem
                    a confiabilidade das previs√µes em dados que o modelo n√£o conhece, e n√£o apenas a memoriza√ß√£o do hist√≥rico.
                </p>
            </div>

        </section>

        <!-- Footer -->
        <footer>
            <p>EcoGrid+ v1.0 | Desenvolvido com Python, Flask, PyTorch e D3.js</p>
            <p>¬© 2025 - Projeto Acad√™mico de Estruturas de Dados Avan√ßadas</p>
        </footer>
    </div>

    <!-- Scripts -->
    <script src="js/api.js"></script>
    <script src="js/network-viz.js"></script>
    <script src="js/main.js"></script>
</body>

</html>